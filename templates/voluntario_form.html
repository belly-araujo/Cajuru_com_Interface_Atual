{% extends "base.html" %}

{% block title %}
  {% if voluntario %}Editar Volunt치rio{% else %}Novo Volunt치rio{% endif %}
{% endblock %}

{% block breadcrumb %}
  Home / Volunt치rio / {% if voluntario %}Editar{% else %}Novo{% endif %}
{% endblock %}

{% block content %}
<form method="POST" enctype="multipart/form-data" class="space-y-4">
  <div class="bg-white border rounded-2xl p-6 max-w-2xl mx-auto shadow-md">
    <h2 class="text-xl font-semibold mb-6">
      {% if voluntario %}Editar Volunt치rio{% else %}Novo Volunt치rio{% endif %}
    </h2>

      <!-- Nome -->
      <div>
        <label class="block text-sm font-medium mb-1">Nome</label>
        <input type="text" name="nome" class="w-full rounded-lg border border-gray-300 p-2"
              value="{{ voluntario.nome if voluntario else '' }}" required>
      </div>

      <!-- Sobrenome -->
      <div>
        <label class="block text-sm font-medium mb-1">Sobrenome</label>
        <input type="text" name="sobrenome" class="w-full rounded-lg border border-gray-300 p-2"
              value="{{ voluntario.sobrenome if voluntario else '' }}">
      </div>

      <!-- CPF -->
      <div>
        <label class="block text-sm font-medium mb-1">CPF</label>
        <input type="text" name="cpf" class="w-full rounded-lg border border-gray-300 p-2"
              value="{{ voluntario.cpf if voluntario else '' }}">
      </div>

      <!-- E-mail -->
      <div>
        <label class="block text-sm font-medium mb-1">E-mail</label>
        <input type="email" name="email" class="w-full rounded-lg border border-gray-300 p-2"
              value="{{ voluntario.email if voluntario else '' }}" required>
      </div>

      <!-- Data de Nascimento -->
      <div>
        <label class="block text-sm font-medium mb-1">Data de Nascimento</label>
        <input type="date" name="data_nascimento" class="w-full rounded-lg border border-gray-300 p-2"
              value="{{ voluntario.data_nascimento.strftime('%Y-%m-%d') if voluntario and voluntario.data_nascimento else '' }}">
      </div>

      <!-- Cart칚o RFID -->
      <div>
        <label class="block text-sm font-medium mb-1" for="id_cartao">Cart칚o RFID</label>
        <input type="text" id="id_cartao" name="id_cartao" class="w-full rounded-lg border border-gray-300 p-2" readonly>
        <p class="text-xs text-gray-500 mt-1">Aproxime o cart칚o no leitor para preencher automaticamente.</p>
      </div>

      <!-- Papel -->
      <div>
        <label class="block text-sm font-medium mb-1">Papel</label>
        <select name="papel" class="w-full rounded-lg border border-gray-300 p-2">
          <option value="voluntario" {% if voluntario and voluntario.role == "voluntario" %}selected{% endif %}>Volunt치rio</option>
          <option value="admin" {% if voluntario and voluntario.role == "admin" %}selected{% endif %}>Administrador</option>
        </select>
      </div>

      <!-- Senha -->
      <div>
        <label class="block text-sm font-medium mb-1">Senha</label>
        <input type="password" name="senha" class="w-full rounded-lg border border-gray-300 p-2"
              {% if not voluntario %}required{% endif %}>
        {% if voluntario %}
          <p class="text-xs text-gray-500 mt-1">Deixe em branco se n칚o quiser alterar a senha.</p>
        {% endif %}
      </div>

          <!-- Upload de PDFs -->
          <div class="border-t pt-4 mt-6">
          <label class="block text-sm font-medium mb-1">Anexar ficha de inten칞칚o para trabalho volunt치rio (opcional)</label>
          <input type="file" name="pdf1" accept=".pdf" class="w-full rounded-lg border border-gray-300 p-2">

          {% if voluntario and voluntario.pdf1_path %}
            <p class="text-xs mt-1">
              游늯 <a href="{{ url_for('static', filename=voluntario.pdf1_path.replace('\\', '/')) }}" target="_blank" class="text-blue-600 underline">Ver PDF 1 atual</a>
            </p>
          {% endif %}

          <label class="block text-sm font-medium mb-1 mt-4">Arquivo destinado ao n칰cleo de servi칞o de volunt치rio (opcional)</label>
          <input type="file" name="pdf2" accept=".pdf" class="w-full rounded-lg border border-gray-300 p-2">

          {% if voluntario and voluntario.pdf2_path %}
            <p class="text-xs mt-1">
              游늯 <a href="{{ url_for('static', filename=voluntario.pdf2_path) }}" target="_blank" class="text-blue-600 underline">Ver PDF 2 atual</a>
            </p>
          {% endif %}

          <label class="block text-sm font-medium mb-1 mt-4">Termo de trabalho ao volunt치rio (opcional)</label>
          <input type="file" name="pdf3" accept=".pdf" class="w-full rounded-lg border border-gray-300 p-2">

          {% if voluntario and voluntario.pdf3_path %}
            <p class="text-xs mt-1">
              游늯 <a href="{{ url_for('static', filename=voluntario.pdf3_path) }}" target="_blank" class="text-blue-600 underline">Ver PDF 3 atual</a>
            </p>
          {% endif %}
        </div>

      <!-- Bot칫es -->
      <div class="flex justify-end space-x-2 mt-4">
        <a href="{{ url_for('voluntarios') }}" class="px-4 py-2 rounded-lg border border-gray-300">Cancelar</a>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
          {% if voluntario %}Salvar Altera칞칫es{% else %}Criar Volunt치rio{% endif %}
        </button>
      </div>
    </form>
  </div>

{% if not voluntarioo %}
  <script>
    // Atualiza o cart칚o automaticamente a cada 1s
    setInterval(() => {
      fetch('/cartao_atual')
        .then(response => response.json())
        .then(data => {
          if (data.id_cartao) {
            document.getElementById('id_cartao').value = data.id_cartao;
          }
        })
        .catch(err => console.error('Erro ao buscar cart칚o:', err));
    }, 1000);
  </script>
{% endif %}
{% endblock %}
